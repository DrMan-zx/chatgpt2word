# 安装指南

本指南将帮助您安装和配置 ChatGPT to Word Converter。

## 快速开始（5分钟）

### 1. 启动 API 服务器
```bash
cd api
docker-compose up -d
```

### 2. 安装 Chrome 扩展
1. 打开 Chrome，访问 `chrome://extensions/`
2. 开启右上角的"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择项目中的 `extension/chrome` 文件夹
5. 扩展安装完成！

### 3. 验证安装
1. 访问 [ChatGPT](https://chat.openai.com)
2. 点击扩展图标
3. 看到"ChatGPT detected"表示安装成功
4. 点击"Convert to Word"测试转换

---

## 详细安装说明

### 方式一：Docker 部署（推荐）

#### 前提条件
- 安装 [Docker](https://www.docker.com/get-started)
- 安装 [Docker Compose](https://docs.docker.com/compose/install/)

#### 步骤

1. **克隆仓库**
   ```bash
   git clone <repository-url>
   cd chatgpt2word
   ```

2. **启动服务**
   ```bash
   cd api
   docker-compose up -d
   ```

3. **验证 API**
   ```bash
   curl http://localhost:8000/health
   # 应该返回: {"status": "healthy"}
   ```

4. **安装扩展**
   ```bash
   # Chrome
   # 1. 打开 chrome://extensions/
   # 2. 开启"开发者模式"
   # 3. 点击"加载已解压的扩展程序"
   # 4. 选择 extension/chrome 文件夹
   ```

5. **测试转换**
   - 打开 ChatGPT 页面
   - 点击扩展图标
   - 点击"Convert to Word"
   - 检查下载的 .docx 文件

#### 停止服务
```bash
docker-compose down
```

#### 更新服务
```bash
docker-compose down
docker-compose up -d --build
```

---

### 方式二：本地部署

#### 前提条件
- Python 3.11+
- Pandoc
- Node.js（用于开发扩展）

#### 安装 Pandoc

**macOS:**
```bash
brew install pandoc
```

**Ubuntu/Debian:**
```bash
sudo apt-get update
sudo apt-get install pandoc texlive-latex-base
```

**Windows:**
1. 下载 Pandoc: https://pandoc.org/installing.html
2. 运行安装程序
3. 验证安装: `pandoc --version`

#### 安装 Python 依赖

```bash
cd api
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

#### 启动 API

```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

#### 安装扩展

按照上面 Docker 方式的步骤 4-5。

#### 停止服务
在终端中按 `Ctrl+C`

---

## 安装验证

### 验证 API 服务
```bash
curl http://localhost:8000
# 应该返回:
# {
#   "service": "ChatGPT to Word Converter",
#   "version": "1.0.0",
#   "status": "running"
# }
```

### 测试转换功能
```bash
# 创建测试 HTML
cat > test.html << 'EOF'
<!DOCTYPE html>
<html>
<body>
  <p>Test formula:</p>
  <span class="katex">
    <annotation encoding="application/x-tex">\int_0^1 x^2 dx = \frac{1}{3}</annotation>
  </span>
</body>
</html>
EOF

# 发送请求
curl -X POST http://localhost:8000/convert \
  -F "html=@test.html" \
  -F "filename=test_conversion" \
  --output result.docx

# 检查文件
ls -lh result.docx
# 应该显示约 5-10KB 的文件
```

### 验证扩展
1. 打开 ChatGPT 页面
2. 点击扩展图标
3. 检查状态显示：
   - ✅ ChatGPT detected
   - API: http://localhost:8000
4. 点击"Preview HTML"查看提取的内容
5. 点击"Convert to Word"下载文件

---

## 常见问题

### Q: 扩展显示"Not a ChatGPT page"
**A:**
- 确保在 `chat.openai.com` 或 `chatgpt.com` 页面
- 刷新页面后重试
- 检查页面是否完全加载

### Q: API 连接失败
**A:**
- 检查 API 服务器是否运行：`curl http://localhost:8000/health`
- 验证端口 8000 没有被占用
- 检查防火墙设置
- 验证扩展中的 API URL 设置

### Q: 转换失败
**A:**
- 检查 HTML 是否包含 KaTeX 公式
- 查看 API 控制台错误日志
- 确认 Pandoc 已正确安装
- 尝试较小的 HTML 内容

### Q: 找不到扩展图标
**A:**
- 检查是否在开发者模式下安装
- 确认选择的是 `extension/chrome` 文件夹
- 在 `chrome://extensions/` 页面查看是否已加载

### Q: Docker 构建失败
**A:**
```bash
# 清理 Docker 缓存
docker system prune -a

# 重新构建
docker-compose build --no-cache
docker-compose up -d
```

---

## 生产环境部署

### 使用 HTTPS

为了安全，生产环境建议使用 HTTPS。

**使用 Nginx 反向代理:**
```nginx
server {
    listen 443 ssl;
    server_name your-api-domain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

**更新扩展 API URL:**
1. 点击扩展图标
2. 在 API URL 字段输入: `https://your-api-domain.com`
3. 保存设置

### 扩展商店发布

发布到 Chrome Web Store 之前：

1. **打包扩展**
   ```bash
   cd extension/chrome
   zip -r chatgpt2word.zip .
   ```

2. **创建商店列表**
   - 名称: "ChatGPT to Word Converter"
   - 描述: 简洁描述功能和用途
   - 分类: Productivity
   - 隐私: 仅声明必要权限

3. **提交审核**
   - 上传 zip 文件
   - 填写表单
   - 等待审核（约 1-3 天）

### 监控和日志

**Docker 部署:**
```bash
# 查看 API 日志
docker-compose logs -f api

# 查看系统资源
docker stats
```

**本地部署:**
```bash
# API 日志输出到控制台
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

---

## 卸载

### 卸载扩展
1. 打开 `chrome://extensions/`
2. 找到 "ChatGPT to Word Converter"
3. 点击"移除"

### 停止 API

**Docker:**
```bash
cd api
docker-compose down
```

**本地:**
在终端中按 `Ctrl+C` 停止服务

### 清理数据
```bash
# Docker
docker system prune -a

# 本地
rm -rf api/venv
rm -f test.html result.docx
```

---

## 获取帮助

- 查看 [API 设计方案](API设计方案.md) 了解技术细节
- 查看 [CLAUDE.md](../docs/CLAUDE.md) 了解开发指南
- 查看 [README.md](../README.md) 了解使用说明
- 提交 [GitHub Issue](repository-url/issues) 报告问题
